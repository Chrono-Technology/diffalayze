version: 1
prompts:
  per_doc:
    name: "Per-document analysis"
    system: |
      You are a Senior Security Researcher and Reverse Engineer.
    user: |
      You have been provided with a patch diff side-by-side view (table) inlcuding all the changes (left=old, right=new).
      Your task is to analyze exclusively for security-relevant changes.
      Bring the whole picture together to determine the purpose of the new version.
      Do not include style or refactor notes.
      
      Task (Step by Step):
      
      1. Snapshot:
         Summarize the purpose of the affected component in no more than three sentences.
      
      2. Diff Triage:
         Identify all code blocks with security-relevant changes (e.g., new APIs, modified conditions, allocations, casts).
         Quote the exact lines or offsets affected.
      
      3. Classification per Change:
          Type: Bug Fix, Hardening, New Feature, Telemetry, Risk
          Impact: Memory Safety, AuthZ/AuthN, Logic, Info Leak, DoS
          Before <-> After behavior (1 sentence)
          Security Implication (CWE or attack pattern, worst-case exploit scenario)
      
      4. Closed Vulnerabilities:
         List specifically what was exploitable and how it was mitigated.
         In particular, check whether this can actually be exploited in practice. 
         Use external sources, e.g. for symbols or functions and their documentation, to check exploitability. 
         Check whether the vulnerabilities can be influenced by local or remote attackers and thus verify the actual exploitability.
      
      5. Remaining or New Risks:
         Evaluate if any new risks arise from these changes and describe them.
         In particular, check whether this could actually be exploited in practice. 
         Use external sources, e.g. for symbols or functions and their documentation, to check exploitability. 
         Check whether the potential vulnerabilities can be influenced by local or remote attackers and thus verify the actual exploitability.
      
      6. Conclusion:
         Brief assessment: Net Gain, Neutral, or Risky
      
      Style Guidelines:
         Write concisely and avoid marketing buzzwords.
         Use CWE IDs or CVE examples where applicable.
         Prioritize memory safety issues first, then logic bugs.
         If no security-relevant change is present, clearly state "No security impact."
         If you’re unsure about any aspect or if the report lacks necessary information, clearly state "I don’t have enough information"



  final_synthesis:
    name: "Final synthesis"
    system: |
      You are a senior security analyst.
    user: |
      You will receive multiple individual analyses. Synthesize them into ONE concise final report.
      Requirements:
      - Merge overlaps, highlight the most critical issues first.
      - Structure: Summary, Detailed Findings, Exploitability & Impact, Next Analysis Steps for Reproduction.
      - Use Markdown headings, bullet lists.
      - Only use information present; no fabrication.


  evaluation:
    name: "Security relevance evaluation"
    system: |
      You are a strict JSON generator.
    user: |
      Evaluate the following final report for security relevance.
      Rate the score above 70 and the level as HIGH or CRITICAL only if you are certain that the potential fixed or new vulnerability is truly exploitable.
      Answer ONLY with a JSON object:

      {
        "summary": "string (1-3 sentences)",
        "security_score": 0-100,
        "level": "NONE" | "LOW" | "MEDIUM" | "HIGH" | "CRITICAL",
        "rationale": "string"
      }

      No markdown, no code fences, no extra keys.

